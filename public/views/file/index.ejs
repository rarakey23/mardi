<%- include('../layouts/alert') %>

<style>
  .image-gallery {
    width: 100%;
    height: 10rem;
    object-fit: cover;
    border-start-start-radius: 5px;
    border-start-end-radius: 5px;
  }

  .fades {
    transition: 0.3s;
  }

  .fades:hover {
    cursor: pointer;
    transform: scale(1.01);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }

  .one-line {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .fix-one-line {
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .backdrop-file {
    position: absolute;
    width: 100%;
    height: 68%;
  }

  .backdrop-file:hover {
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    transition: 0.3s;
    background-color: #2830469e;
    cursor: pointer;
  }

  .backdrop-file:hover .eye-file-- {
    display: block;
  }

  .eye-file-- {
    position: absolute;
    top: 48%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    display: none;
  }
</style>

<link rel="stylesheet" type="text/css" href="/assets/vendors/css/file-uploaders/dropzone.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/plugins/forms/form-file-uploader.css">

<div class="app-content content ">
  <div class="content-overlay"></div>
  <div class="header-navbar-shadow"></div>
  <div class="content-wrapper container-xxl p-0">
    <div class="content-header row">
      <div class="content-header-left col-md-9 col-12 mb-2">
        <div class="row breadcrumbs-top">
          <div class="col-12">
            <h5 class="content-header-title float-start mb-0">Manage File</h5>
          </div>
        </div>
      </div>
    </div>
    <div class="content-body">
      <div class="card">
        <div class="card-header">
          <div class="me-auto">
            File
          </div>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadfile">Upload File</button>
        </div>
        <div class="card-body" style="max-height: 60vh;min-height: 60vh; overflow-y: auto;" id="app___show_file">

        </div>
        <div class="card-footer text-end py-0">
          <small>NJSFile v1.0 nodejs @ilsyaa</small>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade text-start" id="modal-view" tabindex="-1" aria-labelledby="myModalLabel1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="myModalLabel1">Detail File</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <span id="modal-app---lyn"></span>

    </div>
  </div>
</div>

<div class="modal fade" id="uploadfile" tabindex="-1" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">File Upload</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="#" class="dropzone dropzone-area" id="dpz-multiple-files">
          <div class="dz-message">Drop files here or click to upload.</div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="dropzone_clear()">Dropzone Clear</button>
      </div>
    </div>
  </div>
</div>

<script src="/assets/vendors/js/file-uploaders/dropzone.min.js"></script>

<script>
  show()

  function __detail___file(name) {
    let content = $("#modal-app---lyn");
    content.html('<div class="modal-body"><div class="text-center mt-2 mb-2"><div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div></div></div><div class="modal-footer"><small>Loading...</small></div>')
    $("#modal-view").modal('show')
    $.ajax({
      url: `/file/part/detail?name=${name}`,
      type: 'GET',
      success: function(res) {
        content.html(res)
      },
      error: function(err) {
        console.log(err)
      }
    });
  }

  function ___delete_file(name) {
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, delete it!',
      customClass: {
        confirmButton: 'btn btn-primary',
        cancelButton: 'btn btn-outline-danger ms-1'
      },
      buttonsStyling: false
    }).then(function(result) {
      if (result.isConfirmed) {
        $.ajax({
          url: `/file/part/delete?name=${name}`,
          type: 'GET',
          success: function(res) {
            Swal.fire({
              icon: 'success',
              title: 'Deleted!',
              text: `${res.message}`,
              customClass: {
                confirmButton: 'btn btn-success'
              }
            }).then(function() {
              $("#modal-view").modal('hide')
              show()
            })
          },
          error: function(err) {
            console.log(err)
          }
        });
      }
    });
  }


  Dropzone.autoDiscover = false;
  var myDropzone = new Dropzone("#dpz-multiple-files", {
    url: '/file/part/upload',
    paramName: 'file',
  });

  myDropzone.on("complete", function(file) {
    show()
  });

  function dropzone_clear() {
    myDropzone.removeAllFiles(true);
  }


  function show() {
    $.ajax({
      url: `/file/part/show`,
      type: 'GET',
      success: function(res) {
        $("#app___show_file").html(res)
      },
      error: function(err) {
        console.log(err)
      }
    });
  }
</script>